<div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">


    <div data-controller="modal" data-modal-allow-background-close="true" class="py-1 px-3">
        <button data-action="click->modal#open" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            <span>Save Grep Checklist</span>
        </button>
        <!-- Modal Container -->
        <div data-target="modal.container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed inset-0 overflow-y-auto flex items-center justify-center" style="z-index: 9999;">
            <!-- Modal Inner Container -->
            <div class="max-h-screen w-full max-w-lg relative">
                <!-- Modal Card -->
                <div class="m-1 bg-white rounded shadow">
                    <div class="p-8">
                        <h2 class="text-xl mb-4">Save Checklist</h2>
                        <p>Add a name:</p>
                        <input type="text" class="border border-black" id="checklist-name">
                        <div class="flex justify-end items-center flex-wrap mt-6">
                            <%= button_to "Save Grep Checklist", "#", class: "selection-target bg-green-500 hover:bg-green-600 text-white font-bold text-white py-2 px-4 rounded mx-6", data: { reflex: "click->ChecklistReflex#save_checklist", greppable_id: repository.id, name: "", action: "click->modal#close" }, id: "checklist-saver" %>
                            <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded" data-action="click->modal#close">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.getElementById("checklist-name").addEventListener("blur", updateChecklistName);

            function updateChecklistName() {
                var name = document.getElementById("checklist-name").value;
                var saver = document.getElementById("checklist-saver");
                saver.setAttribute("data-name", name);
            }
        </script>
    </div>

    <div data-controller="modal" data-modal-allow-background-close="true" class="py-1 px-3">
        <button data-action="click->modal#open" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            <span>Load Grep Checklist</span>
        </button>
        <!-- Modal Container -->
        <div data-target="modal.container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed inset-0 overflow-y-auto flex items-center justify-center" style="z-index: 9999;">
            <!-- Modal Inner Container -->
            <div class="max-h-screen w-full max-w-lg relative">
                <!-- Modal Card -->
                <div class="m-1 bg-white rounded shadow">
                    <div class="p-8">
                        <h2 class="text-xl mb-4">Load Checklist:</h2>
                        <div>
                            <%= collection_select(:user, :role_id, @checklists, :id, :name, {prompt: "Select Checklist"}, id: "checklist-select", class: "w-full border border-black my-4") %>
                        </div>
                        <div class="text-red-600">
                            WARNING: This will destroy your current list of greps and any results based on them. To avoid losing any of your progress:
                            <ol class="list-decimal px-6">
                                <li>Save the grep checklist.</li>
                                <li>Save the results offline.</li>
                            </ol>
                            <div class="flex justify-end items-center flex-wrap mt-6">
                                <%= button_to "Load Grep Checklist", "#", class: "selection-target bg-green-500 hover:bg-green-600 text-white font-bold text-white py-2 px-4 rounded mx-6", data: { reflex: "click->ChecklistReflex#load_checklist", greppable_id: repository.id, type: "Repository", checklist: "0", action: "click->modal#close" }, id: "checklist-loader" %>
                                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded" data-action="click->modal#close">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                selectChecklist();

                document.getElementById("checklist-select").addEventListener("change", selectChecklist);

                function selectChecklist() {
                    var selector = document.getElementById("checklist-select");
                    var checklist_id = selector.options[selector.selectedIndex].value;
                    var loader = document.getElementById("checklist-loader");
                    if (checklist_id == "") {
                        loader.setAttribute("data-checklist", 0);
                    } else {
                        loader.setAttribute("data-checklist", checklist_id);
                    }
                }
            </script>
        </div>
    </div>

    <div data-controller="modal" data-modal-allow-background-close="true" class="py-1 px-3">
        <button data-action="click->modal#open" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            <span>Run All Greps</span>
        </button>
        <div data-controller="RunGrepsForGreppableReflex" data-reflex-root="[statuslist]">
            <div statuslist>
                <% case grep_status %>
                <% when :default %>
                No jobs running
                <% when :running %>
                Grepping for strings
                <% when :complete %>
                Search complete. <%=link_to "CLICK HERE", "#grep_results" %> to see results.
                <% end %>
            </div>
            <!-- Modal Container -->
            <div data-target="modal.container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed inset-0 overflow-y-auto flex items-center justify-center" style="z-index: 9999;">
                <!-- Modal Inner Container -->
                <div class="max-h-screen w-full max-w-lg relative">
                    <!-- Modal Card -->
                    <div class="m-1 bg-white rounded shadow">
                        <div class="p-8">
                            <h2 class="text-xl mb-4">Are you sure?</h2>
                            <p>This may take a minute if there are a lot of files</p>
                            <div class="flex justify-end items-center flex-wrap mt-6">
                                <%= button_to "Do it", "#", class: "selection-target bg-green-500 hover:bg-green-600 text-white font-bold text-white py-2 px-4 rounded mx-6", data: { reflex: "click->RunGrepsForGreppableReflex#execute", repository: repository.id, type: "Repository", action: "click->modal#close" } %>
                                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded" data-action="click->modal#close">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class='my-4' greplist>
            <% repository.greps.each do |g| %>
            <ul class='py-2'>
                <li class='font-bold'>
                    <%= g.searchterm.value %>
                </li>
                <li>
                    <%= button_to "Remove this grep", "#", class: "bg-red-500 hover:bg-red-600 text-white text-xs px-1 rounded mx-2", data: { reflex: "click->SearchtermReflex#delete", searchterm: g.searchterm.id } %>
                </li>
            </ul>
            <% end %>
        </div>

    </div>
</div>