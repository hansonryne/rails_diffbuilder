<p id="notice"><%= notice %></p>

<% if flash[:alert] %>
  <div id="error_explanation">
    <ul>
      <% flash.each do |key, value| %>
        <li><%= value %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<p>
<strong>Name:</strong>
<%= @repository.name %>
</p>

<p>
<strong>Project:</strong>
<%= @repository.project %>
</p>

<p>
<strong>Languages:</strong>
<p>
<% @repository.languages.each_with_index do |l, index| %>
  <% if index == 0 %>
    <%= l.name %>
    <% next %>
  <% end %>
  <%= ", " + l.name %>
<% end %>
</p>
</p>

<p>
<strong>Repo location:</strong>
<%= @repository.repo_location %>
</p>

<p>
<strong>Reviews:</strong>
<table>
  <thead>
    <tr>
      <th>Start date</th>
      <th>Owner</th>
      <th>Status</th>
      <th colspan="1"></th>
    </tr>
  </thead>
  <tbody>
    <% @repository.reviews.each do |r| %>
      <tr>
        <td><%= r.start_date %></td>
        <td><%= r.owner %></td>
        <td><%= r.get_status %></td>
        <td><%= link_to 'View', r %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</p>

<div>
  <%= link_to 'Create Review of this Repo', new_review_path(repo_id: @repository.id) %> | 
  <%= link_to 'Back', repositories_path %> |
</div>

<div>
  <br>
  <%= render 'updaterepo', repository: @repository %>
</div>

<div>
  <%= link_to "ADD WARNING POPUP Run Greps", "#", class: "selection-target", data: { confirm: 'Are you sure?', reflex: "click->RunGrepsForGreppableReflex#execute", repository: @repository.id, type: "Repository" } %>
  </br>
  <h2>
    Greps:
  </h2>

  <div data-controller="create_grep_from_selection">
    <% case @greps_status %>
    <% when :default %>
      <em>Nothing new...</em>
    <% when :running %>
      <em>Running...</em>
    <% when :ready %>
      <strong><%= @greps_response %></strong>
    <% else %>
    <% end %>
  </div>


  <% @repository.greps.each do |g| %>
    <p>
    <%= g.search_value %>: <%= g.results.nil? ? "Waiting..." : "Done!" %>
    </p>
  <% end %>
</div>

<% @languages.each do |l| %>
  <h2><%= l.name %></h2>
  <%= render 'languages/rules', rules: l.rules, greppable: @repository %>
<% end %>

  <%= render 'modal', greppable: @repository %>
